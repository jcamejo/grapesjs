<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GrapesJS</title>
    <link rel="stylesheet" href="dist/css/grapes.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.9.2/ckeditor.js"></script>
    <script src="dist/grapes.js"></script>
    <script type="text/javascript" src="dist/plugins/grapesjs-blocks-basic.min.js"></script>
    <script type="text/javascript" src="dist/plugins/grapesjs-plugin-ckeditor.js"></script>
    <script type="text/javascript" src="dist/plugins/grapesjs-preset-webpage.min.js"></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>
  <body>
		<div id="gjs" style="">
		</div>
    <script type="text/javascript">
			let editor;
			editor = grapesjs.init({
				showOffsets: 1,
				noticeOnUnload: 0,
				container: '#gjs',
				height: '100%',
				fromElement: true,
				canvas: {
					scripts: [],
					styles:[],
				},
				plugins: ['gjs-blocks-basic', 'gjs-preset-webpage'],
				storageManager: {
					autoload: 1,
					type: 'local',
					autosave: 1
				},
				styleManager : {
					sectors: [{
							name: 'General',
							open: false,
							buildProps: ['float', 'display', 'position', 'top', 'right', 'left', 'bottom']
						},{
							name: 'Flex',
							open: false,
							buildProps: ['flex-direction', 'flex-wrap', 'justify-content', 'align-items', 'align-content', 'order', 'flex-basis', 'flex-grow', 'flex-shrink', 'align-self']
						},{
							name: 'Dimension',
							open: false,
							buildProps: ['width', 'height', 'max-width', 'min-height', 'margin', 'padding'],
						},{
							name: 'Typography',
							open: false,
							buildProps: ['font-family', 'font-size', 'font-weight', 'letter-spacing', 'color', 'line-height', 'text-shadow'],
						},{
							name: 'Decorations',
							open: false,
							buildProps: ['border-radius-c', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
						},{
							name: 'Extra',
							open: false,
							buildProps: ['transition', 'perspective', 'transform'],
						}
					],
				},
			});

			const link = editor.DomComponents.getType('link');

			link.model.extend(Object.assign({}, link.model, {
				defaults: Object.assign({}, link.model.prototype.defaults, {
					traits: [{
						type: 'text',
						label: 'Test',
						href: '',
						changeProp:1,
						className: 'hola!'
					}]
				})
			}))

/*
			editor.on('component:mount', model => {
				if (model.attributes.type == "image" && model.attributes.tagName == "img") {
					var tb = model.get('toolbar');
					var assetsSettings = {
						attributes: { class: 'fa fa-image' },
						command: 'open-assets'
					}

					var assetsCommand = tb.filter(toolbar => toolbar.attributes.class.indexOf('fa-image') > -1);
					if (assetsCommand.length == 0) {
						tb.unshift(assetsSettings);
						model.set('toolbar', tb);
					}
				}

				return model;
			});
			*/
    </script>
  </body>
</html>
